codon_translation_time = {
    'yeast': {
        'AUC': {'Amino acid': 'I', 'Median_time': 128, 'Variance_median': 2, 'Mean_time': 146, 'Variance_mean': 2},
        'GUU': {'Amino acid': 'V', 'Median_time': 129, 'Variance_median': 1, 'Mean_time': 145, 'Variance_mean': 1},
        'AUU': {'Amino acid': 'I', 'Median_time': 133, 'Variance_median': 1, 'Mean_time': 151, 'Variance_mean': 2},
        'ACC': {'Amino acid': 'T', 'Median_time': 135, 'Variance_median': 2, 'Mean_time': 162, 'Variance_mean': 3},
        'GUC': {'Amino acid': 'V', 'Median_time': 137, 'Variance_median': 2, 'Mean_time': 152, 'Variance_mean': 2},
        'CAA': {'Amino acid': 'Q', 'Median_time': 138, 'Variance_median': 2, 'Mean_time': 159, 'Variance_mean': 2},
        'ACU': {'Amino acid': 'T', 'Median_time': 141, 'Variance_median': 1, 'Mean_time': 173, 'Variance_mean': 4},
        'UUA': {'Amino acid': 'L', 'Median_time': 142, 'Variance_median': 2, 'Mean_time': 158, 'Variance_mean': 2},
        'AAC': {'Amino acid': 'N', 'Median_time': 148, 'Variance_median': 2, 'Mean_time': 166, 'Variance_mean': 2},
        'GCC': {'Amino acid': 'A', 'Median_time': 148, 'Variance_median': 2, 'Mean_time': 166, 'Variance_mean': 2},
        'AAU': {'Amino acid': 'N', 'Median_time': 149, 'Variance_median': 2, 'Mean_time': 168, 'Variance_mean': 2},
        'GCU': {'Amino acid': 'A', 'Median_time': 149, 'Variance_median': 1, 'Mean_time': 164, 'Variance_mean': 1},
        'UCU': {'Amino acid': 'S', 'Median_time': 150, 'Variance_median': 2, 'Mean_time': 167, 'Variance_mean': 2},
        'UUC': {'Amino acid': 'F', 'Median_time': 152, 'Variance_median': 2, 'Mean_time': 168, 'Variance_mean': 2},
        'AAG': {'Amino acid': 'K', 'Median_time': 155, 'Variance_median': 2, 'Mean_time': 194, 'Variance_mean': 2},
        'UUU': {'Amino acid': 'F', 'Median_time': 157, 'Variance_median': 2, 'Mean_time': 172, 'Variance_mean': 2},
        'UCC': {'Amino acid': 'S', 'Median_time': 160, 'Variance_median': 3, 'Mean_time': 177, 'Variance_mean': 2},
        'UGU': {'Amino acid': 'C', 'Median_time': 161, 'Variance_median': 3, 'Mean_time': 178, 'Variance_mean': 3},
        'UUG': {'Amino acid': 'L', 'Median_time': 161, 'Variance_median': 2, 'Mean_time': 179, 'Variance_mean': 2},
        'CAU': {'Amino acid': 'H', 'Median_time': 164, 'Variance_median': 3, 'Mean_time': 185, 'Variance_mean': 3},
        'AUG': {'Amino acid': 'M', 'Median_time': 167, 'Variance_median': 3, 'Mean_time': 182, 'Variance_mean': 2},
        'CGU': {'Amino acid': 'R', 'Median_time': 167, 'Variance_median': 5, 'Mean_time': 192, 'Variance_mean': 4},
        'GAU': {'Amino acid': 'D', 'Median_time': 175, 'Variance_median': 2, 'Mean_time': 200, 'Variance_mean': 2},
        'UAU': {'Amino acid': 'Y', 'Median_time': 176, 'Variance_median': 4, 'Mean_time': 191, 'Variance_mean': 3},
        'CUA': {'Amino acid': 'L', 'Median_time': 178, 'Variance_median': 3, 'Mean_time': 194, 'Variance_mean': 3},
        'AAA': {'Amino acid': 'K', 'Median_time': 179, 'Variance_median': 2, 'Mean_time': 216, 'Variance_mean': 3},
        'UCA': {'Amino acid': 'S', 'Median_time': 180, 'Variance_median': 5, 'Mean_time': 200, 'Variance_mean': 3},
        'GAC': {'Amino acid': 'D', 'Median_time': 181, 'Variance_median': 2, 'Mean_time': 202, 'Variance_mean': 2},
        'GGU': {'Amino acid': 'G', 'Median_time': 182, 'Variance_median': 2, 'Mean_time': 223, 'Variance_mean': 3},
        'AGU': {'Amino acid': 'S', 'Median_time': 184, 'Variance_median': 4, 'Mean_time': 201, 'Variance_mean': 4},
        'CUU': {'Amino acid': 'L', 'Median_time': 184, 'Variance_median': 4, 'Mean_time': 204, 'Variance_mean': 4},
        'GAA': {'Amino acid': 'E', 'Median_time': 184, 'Variance_median': 2, 'Mean_time': 206, 'Variance_mean': 1},
        'GUA': {'Amino acid': 'V', 'Median_time': 185, 'Variance_median': 5, 'Mean_time': 204, 'Variance_mean': 4},
        'CAC': {'Amino acid': 'H', 'Median_time': 186, 'Variance_median': 4, 'Mean_time': 208, 'Variance_mean': 4},
        'AGA': {'Amino acid': 'R', 'Median_time': 191, 'Variance_median': 2, 'Mean_time': 218, 'Variance_mean': 3},
        'UAC': {'Amino acid': 'Y', 'Median_time': 196, 'Variance_median': 2, 'Mean_time': 216, 'Variance_mean': 2},
        'AGC': {'Amino acid': 'S', 'Median_time': 205, 'Variance_median': 5, 'Mean_time': 217, 'Variance_mean': 4},
        'CCA': {'Amino acid': 'P', 'Median_time': 206, 'Variance_median': 3, 'Mean_time': 238, 'Variance_mean': 3},
        'CAG': {'Amino acid': 'Q', 'Median_time': 212, 'Variance_median': 5, 'Mean_time': 237, 'Variance_mean': 5},
        'GCA': {'Amino acid': 'A', 'Median_time': 220, 'Variance_median': 4, 'Mean_time': 239, 'Variance_mean': 3},
        'GGC': {'Amino acid': 'G', 'Median_time': 233, 'Variance_median': 4, 'Mean_time': 277, 'Variance_mean': 6},
        'GAG': {'Amino acid': 'E', 'Median_time': 234, 'Variance_median': 4, 'Mean_time': 255, 'Variance_mean': 3},
        'CCU': {'Amino acid': 'P', 'Median_time': 235, 'Variance_median': 5, 'Mean_time': 271, 'Variance_mean': 4},
        'AUA': {'Amino acid': 'I', 'Median_time': 236, 'Variance_median': 8, 'Mean_time': 273, 'Variance_mean': 6},
        'ACA': {'Amino acid': 'T', 'Median_time': 237, 'Variance_median': 4, 'Mean_time': 260, 'Variance_mean': 4},
        'GUG': {'Amino acid': 'V', 'Median_time': 238, 'Variance_median': 5, 'Mean_time': 264, 'Variance_mean': 5},
        'UGC': {'Amino acid': 'C', 'Median_time': 244, 'Variance_median': 7, 'Mean_time': 273, 'Variance_mean': 9},
        'UCG': {'Amino acid': 'S', 'Median_time': 253, 'Variance_median': 7, 'Mean_time': 282, 'Variance_mean': 7},
        'CUC': {'Amino acid': 'L', 'Median_time': 256, 'Variance_median': 8, 'Mean_time': 283, 'Variance_mean': 9},
        'CGC': {'Amino acid': 'R', 'Median_time': 260, 'Variance_median': 20, 'Mean_time': 286, 'Variance_mean': 14},
        'GCG': {'Amino acid': 'A', 'Median_time': 271, 'Variance_median': 11, 'Mean_time': 307, 'Variance_mean': 8},
        'GGA': {'Amino acid': 'G', 'Median_time': 271, 'Variance_median': 6, 'Mean_time': 320, 'Variance_mean': 10},
        'AGG': {'Amino acid': 'R', 'Median_time': 273, 'Variance_median': 9, 'Mean_time': 318, 'Variance_mean': 9},
        'UGG': {'Amino acid': 'W', 'Median_time': 275, 'Variance_median': 5, 'Mean_time': 325, 'Variance_mean': 6},
        'CUG': {'Amino acid': 'L', 'Median_time': 281, 'Variance_median': 6, 'Mean_time': 305, 'Variance_mean': 7},
        'GGG': {'Amino acid': 'G', 'Median_time': 287, 'Variance_median': 8, 'Mean_time': 326, 'Variance_mean': 9},
        'ACG': {'Amino acid': 'T', 'Median_time': 296, 'Variance_median': 7, 'Mean_time': 323, 'Variance_mean': 8},
        'CCC': {'Amino acid': 'P', 'Median_time': 315, 'Variance_median': 10, 'Mean_time': 356, 'Variance_mean': 10},
        'CGG': {'Amino acid': 'R', 'Median_time': 360, 'Variance_median': 70, 'Mean_time': 427, 'Variance_mean': 54},
        'CCG': {'Amino acid': 'P', 'Median_time': 455, 'Variance_median': 21, 'Mean_time': 504, 'Variance_mean': 23},
        'CGA': {'Amino acid': 'R', 'Median_time': 496, 'Variance_median': 61, 'Mean_time': 482, 'Variance_mean': 45},
        'UAA': {'Amino acid': 'STOP', 'Median_time': 144, 'Variance_median': 8, 'Mean_time': 185, 'Variance_mean': 13},
        'UAG': {'Amino acid': 'STOP', 'Median_time': 255, 'Variance_median': 24, 'Mean_time': 311, 'Variance_mean': 20},
        'UGA': {'Amino acid': 'STOP', 'Median_time': 317, 'Variance_median': 22, 'Mean_time': 376, 'Variance_mean': 32}
    },
    'ecoli': {
        'UUU': {'Amino acid': 'F', 'Median_time': 68.164, 'Variance_median': 0, 'Mean_time': 68.164, 'Variance_mean': 0},
        'UUC': {'Amino acid': 'F', 'Median_time': 97.735, 'Variance_median': 0, 'Mean_time': 97.735, 'Variance_mean': 0},
        'UUG': {'Amino acid': 'L', 'Median_time': 25.060, 'Variance_median': 0, 'Mean_time': 25.060, 'Variance_mean': 0},
        'UUA': {'Amino acid': 'L', 'Median_time': 78.689, 'Variance_median': 0, 'Mean_time': 78.689, 'Variance_mean': 0},
        'UCU': {'Amino acid': 'S', 'Median_time': 27.566, 'Variance_median': 0, 'Mean_time': 27.566, 'Variance_mean': 0},
        'UCC': {'Amino acid': 'S', 'Median_time': 123.297, 'Variance_median': 0, 'Mean_time': 123.297, 'Variance_mean': 0},
        'UCG': {'Amino acid': 'S', 'Median_time': 48.116, 'Variance_median': 0, 'Mean_time': 48.116, 'Variance_mean': 0},
        'UCA': {'Amino acid': 'S', 'Median_time': 53.128, 'Variance_median': 0, 'Mean_time': 53.128, 'Variance_mean': 0},
        'UGU': {'Amino acid': 'C', 'Median_time': 37.590, 'Variance_median': 0, 'Mean_time': 37.590, 'Variance_mean': 0},
        'UGC': {'Amino acid': 'C', 'Median_time': 54.631, 'Variance_median': 0, 'Mean_time': 54.631, 'Variance_mean': 0},
        'UGG': {'Amino acid': 'W', 'Median_time': 84.203, 'Variance_median': 0, 'Mean_time': 84.203, 'Variance_mean': 0},
        'UGA': {'Amino acid': 'STOP', 'Median_time': 6.014, 'Variance_median': 0, 'Mean_time': 6.014, 'Variance_mean': 0},
        'UAU': {'Amino acid': 'Y', 'Median_time': 26.564, 'Variance_median': 0, 'Mean_time': 26.564, 'Variance_mean': 0},
        'UAC': {'Amino acid': 'Y', 'Median_time': 38.593, 'Variance_median': 0, 'Mean_time': 38.593, 'Variance_mean': 0},
        'UAG': {'Amino acid': 'STOP', 'Median_time': 9.523, 'Variance_median': 0, 'Mean_time': 9.523, 'Variance_mean': 0},
        'UAA': {'Amino acid': 'STOP', 'Median_time': 5.513, 'Variance_median': 0, 'Mean_time': 5.513, 'Variance_mean': 0},
        'CUU': {'Amino acid': 'L', 'Median_time': 130.314, 'Variance_median': 0, 'Mean_time': 130.314, 'Variance_mean': 0},
        'CUC': {'Amino acid': 'L', 'Median_time': 102.246, 'Variance_median': 0, 'Mean_time': 102.246, 'Variance_mean': 0},
        'CUG': {'Amino acid': 'L', 'Median_time': 17.542, 'Variance_median': 0, 'Mean_time': 17.542, 'Variance_mean': 0},
        'CUA': {'Amino acid': 'L', 'Median_time': 143.345, 'Variance_median': 0, 'Mean_time': 143.345, 'Variance_mean': 0},
        'CCU': {'Amino acid': 'P', 'Median_time': 71.672, 'Variance_median': 0, 'Mean_time': 71.672, 'Variance_mean': 0},
        'CCC': {'Amino acid': 'P', 'Median_time': 98.738, 'Variance_median': 0, 'Mean_time': 98.738, 'Variance_mean': 0},
        'CCG': {'Amino acid': 'P', 'Median_time': 67.162, 'Variance_median': 0, 'Mean_time': 67.162, 'Variance_mean': 0},
        'CCA': {'Amino acid': 'P', 'Median_time': 118.786, 'Variance_median': 0, 'Mean_time': 118.786, 'Variance_mean': 0},
        'CGU': {'Amino acid': 'R', 'Median_time': 14.034, 'Variance_median': 0, 'Mean_time': 14.034, 'Variance_mean': 0},
        'CGC': {'Amino acid': 'R', 'Median_time': 17.542, 'Variance_median': 0, 'Mean_time': 17.542, 'Variance_mean': 0},
        'CGG': {'Amino acid': 'R', 'Median_time': 198.979, 'Variance_median': 0, 'Mean_time': 198.979, 'Variance_mean': 0},
        'CGA': {'Amino acid': 'R', 'Median_time': 17.041, 'Variance_median': 0, 'Mean_time': 17.041, 'Variance_mean': 0},
        'CAU': {'Amino acid': 'H', 'Median_time': 148.357, 'Variance_median': 0, 'Mean_time': 148.357, 'Variance_mean': 0},
        'CAC': {'Amino acid': 'H', 'Median_time': 111.268, 'Variance_median': 0, 'Mean_time': 111.268, 'Variance_mean': 0},
        'CAG': {'Amino acid': 'Q', 'Median_time': 115.779, 'Variance_median': 0, 'Mean_time': 115.779, 'Variance_mean': 0},
        'CAA': {'Amino acid': 'Q', 'Median_time': 89.716, 'Variance_median': 0, 'Mean_time': 89.716, 'Variance_mean': 0},
        'GUU': {'Amino acid': 'V', 'Median_time': 13.031, 'Variance_median': 0, 'Mean_time': 13.031, 'Variance_mean': 0},
        'GUC': {'Amino acid': 'V', 'Median_time': 104.251, 'Variance_median': 0, 'Mean_time': 104.251, 'Variance_mean': 0},
        'GUG': {'Amino acid': 'V', 'Median_time': 21.051, 'Variance_median': 0, 'Mean_time': 21.051, 'Variance_mean': 0},
        'GUA': {'Amino acid': 'V', 'Median_time': 36.588, 'Variance_median': 0, 'Mean_time': 36.588, 'Variance_mean': 0},
        'GCU': {'Amino acid': 'A', 'Median_time': 19.547, 'Variance_median': 0, 'Mean_time': 19.547, 'Variance_mean': 0},
        'GCC': {'Amino acid': 'A', 'Median_time': 208.000, 'Variance_median': 0, 'Mean_time': 208.000, 'Variance_mean': 0},
        'GCG': {'Amino acid': 'A', 'Median_time': 22.053, 'Variance_median': 0, 'Mean_time': 22.053, 'Variance_mean': 0},
        'GCA': {'Amino acid': 'A', 'Median_time': 41.600, 'Variance_median': 0, 'Mean_time': 41.600, 'Variance_mean': 0},
        'GGU': {'Amino acid': 'G', 'Median_time': 17.542, 'Variance_median': 0, 'Mean_time': 17.542, 'Variance_mean': 0},
        'GGC': {'Amino acid': 'G', 'Median_time': 24.559, 'Variance_median': 0, 'Mean_time': 24.559, 'Variance_mean': 0},
        'GGG': {'Amino acid': 'G', 'Median_time': 40.598, 'Variance_median': 0, 'Mean_time': 40.598, 'Variance_mean': 0},
        'GGA': {'Amino acid': 'G', 'Median_time': 162.391, 'Variance_median': 0, 'Mean_time': 162.391, 'Variance_mean': 0},
        'GAU': {'Amino acid': 'D', 'Median_time': 38.593, 'Variance_median': 0, 'Mean_time': 38.593, 'Variance_mean': 0},
        'GAC': {'Amino acid': 'D', 'Median_time': 58.140, 'Variance_median': 0, 'Mean_time': 58.140, 'Variance_mean': 0},
        'GAG': {'Amino acid': 'E', 'Median_time': 18.043, 'Variance_median': 0, 'Mean_time': 18.043, 'Variance_mean': 0},
        'GAA': {'Amino acid': 'E', 'Median_time': 28.569, 'Variance_median': 0, 'Mean_time': 28.569, 'Variance_mean': 0},
        'AUU': {'Amino acid': 'I', 'Median_time': 48.617, 'Variance_median': 0, 'Mean_time': 48.617, 'Variance_mean': 0},
        'AUC': {'Amino acid': 'I', 'Median_time': 64.154, 'Variance_median': 0, 'Mean_time': 64.154, 'Variance_mean': 0},
        'AUG': {'Amino acid': 'M', 'Median_time': 133.321, 'Variance_median': 0, 'Mean_time': 133.321, 'Variance_mean': 0},
        'AUA': {'Amino acid': 'I', 'Median_time': 64.154, 'Variance_median': 0, 'Mean_time': 64.154, 'Variance_mean': 0},
        'ACU': {'Amino acid': 'T', 'Median_time': 27.566, 'Variance_median': 0, 'Mean_time': 27.566, 'Variance_mean': 0},
        'ACC': {'Amino acid': 'T', 'Median_time': 76.685, 'Variance_median': 0, 'Mean_time': 76.685, 'Variance_mean': 0},
        'ACG': {'Amino acid': 'T', 'Median_time': 64.656, 'Variance_median': 0, 'Mean_time': 64.656, 'Variance_mean': 0},
        'ACA': {'Amino acid': 'T', 'Median_time': 89.215, 'Variance_median': 0, 'Mean_time': 89.215, 'Variance_mean': 0},
        'AGU': {'Amino acid': 'S', 'Median_time': 42.603, 'Variance_median': 0, 'Mean_time': 42.603, 'Variance_mean': 0},
        'AGC': {'Amino acid': 'S', 'Median_time': 63.653, 'Variance_median': 0, 'Mean_time': 63.653, 'Variance_mean': 0},
        'AGG': {'Amino acid': 'R', 'Median_time': 231.056, 'Variance_median': 0, 'Mean_time': 231.056, 'Variance_mean': 0},
        'AGA': {'Amino acid': 'R', 'Median_time': 95.229, 'Variance_median': 0, 'Mean_time': 95.229, 'Variance_mean': 0},
        'AAU': {'Amino acid': 'N', 'Median_time': 54.631, 'Variance_median': 0, 'Mean_time': 54.631, 'Variance_mean': 0},
        'AAC': {'Amino acid': 'N', 'Median_time': 80.694, 'Variance_median': 0, 'Mean_time': 80.694, 'Variance_mean': 0},
        'AAG': {'Amino acid': 'K', 'Median_time': 51.123, 'Variance_median': 0, 'Mean_time': 51.123, 'Variance_mean': 0},
        'AAA': {'Amino acid': 'K', 'Median_time': 38.092, 'Variance_median': 0, 'Mean_time': 38.092, 'Variance_mean': 0},
    },
}


def parse_nascent_sequence(nascent_pdb):
    """
    Parse a nascent-chain PDB file to extract the amino acid sequence.

    Parameters
    ----------
    nascent_pdb : str
        Path to PDB file (e.g. nascent.pdb).

    Returns
    -------
    list of tuple (str, int)
        List of (residue_name, residue_number) in order, e.g. [('MET', 1), ('LYS', 2), ...].
        Residue names are three-letter codes (columns 17-20 in ATOM/HETATM lines).
    """
    sequence = []
    with open(nascent_pdb, 'r') as f:
        for line in f:
            if line.startswith('ATOM') or line.startswith('HETATM'):
                res_name = line[17:20].strip()
                res_num = int(line[22:26].strip())
                sequence.append((res_name, res_num))
    return sequence


# Standard three-letter to one-letter amino acid code (for PDB-style input)
_THREE_TO_ONE = {
    'ALA': 'A', 'ARG': 'R', 'ASN': 'N', 'ASP': 'D', 'CYS': 'C', 'GLN': 'Q', 'GLU': 'E',
    'GLY': 'G', 'HIS': 'H', 'ILE': 'I', 'LEU': 'L', 'LYS': 'K', 'MET': 'M', 'PHE': 'F',
    'PRO': 'P', 'SER': 'S', 'THR': 'T', 'TRP': 'W', 'TYR': 'Y', 'VAL': 'V',
    'SEC': 'U', 'PYL': 'O',  # selenocysteine, pyrrolysine
}


def _build_aa_to_codons(organism='yeast'):
    """Build mapping amino acid -> list of (codon, median_time) from codon_translation_time."""
    if organism not in codon_translation_time:
        raise ValueError(f"organism must be one of {list(codon_translation_time.keys())}, got {organism!r}")
    table = codon_translation_time[organism]
    aa_to_codons = {}
    for codon, info in table.items():
        aa = info['Amino acid']
        t = info['Median_time']
        if aa not in aa_to_codons:
            aa_to_codons[aa] = []
        aa_to_codons[aa].append((codon, t))
    return aa_to_codons


def _normalize_aa(aa):
    """Convert to one-letter code. Accepts one-letter, three-letter, or 'STOP'/'*'."""
    if len(aa) == 1:
        return aa.upper() if aa.upper() != '*' else 'STOP'
    if len(aa) == 3:
        return _THREE_TO_ONE.get(aa.upper(), aa)
    if aa.upper() in ('STOP', '*'):
        return 'STOP'
    return aa.upper()


def generate_mRNA_sequence(nascent_sequence, translation_type, organism='yeast'):
    """
    Generate an mRNA (codon) sequence that translates to the given amino acid sequence,
    optimized for either fastest or slowest translation according to codon translation time.

    Parameters
    ----------
    nascent_sequence : str or list
        Amino acid sequence: either a string of one-letter codes (e.g. "MKFL"),
        a string of three-letter codes separated by spaces (e.g. "MET LYS PHE LEU"),
        or a list of one-letter or three-letter codes. Use '*' or 'STOP' for stop.
    translation_type : str
        'fast' : choose the codon with smallest translation time for each amino acid
                 (fastest mRNA to translate the nascent sequence).
        'slow' : choose the codon with largest translation time for each amino acid
                 (slowest mRNA to translate the nascent sequence).
    organism : str, optional
        'yeast' or 'ecoli' (translation time table to use). Default 'yeast'.

    Returns
    -------
    tuple (str, float)
        mRNA : mRNA sequence as concatenated codons (e.g. "AUGAAAUUCUUG...").
        translation_time_ms : estimated total translation time in milliseconds (sum of
            median codon translation times for the chosen codons).
    """
    if translation_type not in ('fast', 'slow'):
        raise ValueError("translation_type must be 'fast' or 'slow'")
    aa_to_codons = _build_aa_to_codons(organism)

    # Normalize input to list of one-letter amino acids
    if isinstance(nascent_sequence, str):
        s = nascent_sequence.strip().upper().replace(',', ' ')
        if not s:
            return '', 0.0
        # Space-separated tokens (three-letter or one-letter per token)
        if ' ' in s:
            parts = s.split()
            aas = [_THREE_TO_ONE.get(p.upper(), _normalize_aa(p)) if len(p) == 3 else _normalize_aa(p) for p in parts]
        # Concatenated three-letter codes (length multiple of 3, each chunk in table)
        elif len(s) % 3 == 0 and all(s[i:i+3] in _THREE_TO_ONE for i in range(0, len(s), 3)):
            aas = [_THREE_TO_ONE[s[i:i+3]] for i in range(0, len(s), 3)]
        else:
            aas = [_normalize_aa(c) for c in s if c.strip()]
    else:
        aas = [_normalize_aa(str(a)) for a in nascent_sequence]

    codons = []
    translation_time_ms = 0.0
    for aa in aas:
        if aa not in aa_to_codons:
            raise ValueError(f"Unknown amino acid {aa!r}; cannot map to codon.")
        choices = aa_to_codons[aa]
        if translation_type == 'fast':
            chosen = min(choices, key=lambda x: x[1])
        else:
            chosen = max(choices, key=lambda x: x[1])
        codons.append(chosen[0])
        translation_time_ms += chosen[1]

    return ''.join(codons), translation_time_ms